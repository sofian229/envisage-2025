{"ast":null,"code":"var _jsxFileName = \"C:\\\\Programming\\\\Clubs\\\\CIS\\\\HackPrix\\\\drift-guard-1pm\\\\client\\\\src\\\\components\\\\Map\\\\LocationMap.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport './LocationMap.css';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { useLocation } from '../../contexts/LocationContext';\n\n// Fix Leaflet icon issues\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png')\n});\nconst LocationMap = () => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const {\n    myLocation,\n    connectedUsers\n  } = useLocation();\n  const [allLocations, setAllLocations] = useState([]);\n  const mapRef = useRef(null);\n  const leafletMapRef = useRef(null);\n  const markersRef = useRef({});\n\n  // Initialize map\n  useEffect(() => {\n    if (!mapRef.current) return;\n\n    // Create map if it doesn't exist\n    if (!leafletMapRef.current) {\n      leafletMapRef.current = L.map(mapRef.current).setView([51.505, -0.09], 13);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n      }).addTo(leafletMapRef.current);\n    }\n\n    // Cleanup function\n    return () => {\n      if (leafletMapRef.current) {\n        leafletMapRef.current.remove();\n        leafletMapRef.current = null;\n      }\n    };\n  }, []);\n\n  // Update locations\n  useEffect(() => {\n    const locations = [];\n\n    // Add my location if available\n    if (myLocation && myLocation.latitude && myLocation.longitude) {\n      locations.push({\n        id: 'me',\n        name: 'My Location',\n        role: (user === null || user === void 0 ? void 0 : user.role) || 'unknown',\n        lat: myLocation.latitude,\n        lng: myLocation.longitude,\n        isMe: true\n      });\n    }\n\n    // Add connected users' locations\n    Object.values(connectedUsers).forEach(connectedUser => {\n      if (connectedUser.coordinates && connectedUser.coordinates.latitude && connectedUser.coordinates.longitude) {\n        locations.push({\n          id: connectedUser.userId,\n          name: connectedUser.userName,\n          role: connectedUser.role,\n          lat: connectedUser.coordinates.latitude,\n          lng: connectedUser.coordinates.longitude,\n          isMe: false\n        });\n      }\n    });\n    setAllLocations(locations);\n  }, [myLocation, connectedUsers, user]);\n\n  // Update markers when locations change\n  useEffect(() => {\n    if (!leafletMapRef.current || allLocations.length === 0) return;\n\n    // Clear existing markers\n    Object.values(markersRef.current).forEach(marker => {\n      leafletMapRef.current.removeLayer(marker);\n    });\n    markersRef.current = {};\n\n    // Add new markers\n    allLocations.forEach(location => {\n      const marker = L.marker([location.lat, location.lng]).addTo(leafletMapRef.current).bindPopup(`\n          <strong>${location.name}</strong><br>\n          Role: ${location.role}<br>\n          ${!location.isMe ? `Last updated: ${new Date().toLocaleTimeString()}` : ''}\n        `);\n      markersRef.current[location.id] = marker;\n    });\n\n    // Fit map to show all markers\n    if (allLocations.length === 1) {\n      leafletMapRef.current.setView([allLocations[0].lat, allLocations[0].lng], 15);\n    } else {\n      const bounds = L.latLngBounds(allLocations.map(loc => [loc.lat, loc.lng]));\n      leafletMapRef.current.fitBounds(bounds, {\n        padding: [50, 50]\n      });\n    }\n  }, [allLocations]);\n  if (!myLocation && Object.keys(connectedUsers).length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"location-map-container loading\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Waiting for location data...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"location-map-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapRef,\n      style: {\n        height: '100%',\n        width: '100%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n};\n_s(LocationMap, \"jP4WFXAl3p5BBrwxYTb50qjC6Ps=\", false, function () {\n  return [useAuth, useLocation];\n});\n_c = LocationMap;\nexport default LocationMap;\nvar _c;\n$RefreshReg$(_c, \"LocationMap\");","map":{"version":3,"names":["React","useState","useEffect","useRef","L","useAuth","useLocation","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","require","iconUrl","shadowUrl","LocationMap","_s","user","myLocation","connectedUsers","allLocations","setAllLocations","mapRef","leafletMapRef","markersRef","current","map","setView","tileLayer","attribution","addTo","remove","locations","latitude","longitude","push","id","name","role","lat","lng","isMe","Object","values","forEach","connectedUser","coordinates","userId","userName","length","marker","removeLayer","location","bindPopup","Date","toLocaleTimeString","bounds","latLngBounds","loc","fitBounds","padding","keys","className","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","style","height","width","_c","$RefreshReg$"],"sources":["C:/Programming/Clubs/CIS/HackPrix/drift-guard-1pm/client/src/components/Map/LocationMap.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport './LocationMap.css';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { useLocation } from '../../contexts/LocationContext';\n\n// Fix Leaflet icon issues\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png')\n});\n\nconst LocationMap = () => {\n  const { user } = useAuth();\n  const { myLocation, connectedUsers } = useLocation();\n  const [allLocations, setAllLocations] = useState([]);\n  const mapRef = useRef(null);\n  const leafletMapRef = useRef(null);\n  const markersRef = useRef({});\n\n  // Initialize map\n  useEffect(() => {\n    if (!mapRef.current) return;\n    \n    // Create map if it doesn't exist\n    if (!leafletMapRef.current) {\n      leafletMapRef.current = L.map(mapRef.current).setView([51.505, -0.09], 13);\n      \n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n      }).addTo(leafletMapRef.current);\n    }\n    \n    // Cleanup function\n    return () => {\n      if (leafletMapRef.current) {\n        leafletMapRef.current.remove();\n        leafletMapRef.current = null;\n      }\n    };\n  }, []);\n\n  // Update locations\n  useEffect(() => {\n    const locations = [];\n    \n    // Add my location if available\n    if (myLocation && myLocation.latitude && myLocation.longitude) {\n      locations.push({\n        id: 'me',\n        name: 'My Location',\n        role: user?.role || 'unknown',\n        lat: myLocation.latitude,\n        lng: myLocation.longitude,\n        isMe: true\n      });\n    }\n    \n    // Add connected users' locations\n    Object.values(connectedUsers).forEach(connectedUser => {\n      if (connectedUser.coordinates && \n          connectedUser.coordinates.latitude && \n          connectedUser.coordinates.longitude) {\n        locations.push({\n          id: connectedUser.userId,\n          name: connectedUser.userName,\n          role: connectedUser.role,\n          lat: connectedUser.coordinates.latitude,\n          lng: connectedUser.coordinates.longitude,\n          isMe: false\n        });\n      }\n    });\n    \n    setAllLocations(locations);\n  }, [myLocation, connectedUsers, user]);\n\n  // Update markers when locations change\n  useEffect(() => {\n    if (!leafletMapRef.current || allLocations.length === 0) return;\n    \n    // Clear existing markers\n    Object.values(markersRef.current).forEach(marker => {\n      leafletMapRef.current.removeLayer(marker);\n    });\n    markersRef.current = {};\n    \n    // Add new markers\n    allLocations.forEach(location => {\n      const marker = L.marker([location.lat, location.lng])\n        .addTo(leafletMapRef.current)\n        .bindPopup(`\n          <strong>${location.name}</strong><br>\n          Role: ${location.role}<br>\n          ${!location.isMe ? `Last updated: ${new Date().toLocaleTimeString()}` : ''}\n        `);\n      \n      markersRef.current[location.id] = marker;\n    });\n    \n    // Fit map to show all markers\n    if (allLocations.length === 1) {\n      leafletMapRef.current.setView([allLocations[0].lat, allLocations[0].lng], 15);\n    } else {\n      const bounds = L.latLngBounds(allLocations.map(loc => [loc.lat, loc.lng]));\n      leafletMapRef.current.fitBounds(bounds, { padding: [50, 50] });\n    }\n  }, [allLocations]);\n\n  if (!myLocation && Object.keys(connectedUsers).length === 0) {\n    return (\n      <div className=\"location-map-container loading\">\n        <p>Waiting for location data...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"location-map-container\">\n      <div ref={mapRef} style={{ height: '100%', width: '100%' }}></div>\n    </div>\n  );\n};\n\nexport default LocationMap;\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}