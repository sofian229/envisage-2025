{"ast":null,"code":"var _jsxFileName = \"C:\\\\Programming\\\\Clubs\\\\CIS\\\\HackPrix\\\\drift-guard-1pm\\\\client\\\\src\\\\contexts\\\\LocationContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useEffect, useContext } from 'react';\nimport { useAuth } from './AuthContext';\nimport webSocketService from '../utils/websocket';\nimport locationService from '../utils/locationService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LocationContext = /*#__PURE__*/createContext();\nexport const useLocation = () => {\n  _s();\n  return useContext(LocationContext);\n};\n_s(useLocation, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const LocationProvider = ({\n  children\n}) => {\n  _s2();\n  const {\n    user\n  } = useAuth();\n  const [myLocation, setMyLocation] = useState(null);\n  const [connectedUsers, setConnectedUsers] = useState({});\n  const [isTracking, setIsTracking] = useState(false);\n  const [trackingError, setTrackingError] = useState(null);\n\n  // Initialize WebSocket connection when user is authenticated\n  useEffect(() => {\n    if (!user) return;\n    const token = localStorage.getItem('userToken');\n    if (!token) return;\n\n    // Connect to WebSocket\n    webSocketService.connect(token);\n\n    // Add WebSocket message listener\n    const handleMessage = data => {\n      if (data.type === 'locationUpdate' && data.userId !== user.id) {\n        setConnectedUsers(prev => ({\n          ...prev,\n          [data.userId]: {\n            userId: data.userId,\n            userName: data.userName,\n            role: data.role,\n            coordinates: data.coordinates,\n            timestamp: data.timestamp\n          }\n        }));\n      }\n    };\n    webSocketService.addListener('message', handleMessage);\n\n    // Cleanup\n    return () => {\n      webSocketService.removeListener('message', handleMessage);\n      webSocketService.disconnect();\n    };\n  }, [user]);\n\n  // Start location tracking\n  const startLocationTracking = () => {\n    if (!user) {\n      setTrackingError('User must be logged in to track location');\n      return false;\n    }\n    setTrackingError(null);\n\n    // Add location update listener\n    const handleLocationUpdate = coordinates => {\n      setMyLocation(coordinates);\n      setIsTracking(true);\n    };\n    const handleLocationError = error => {\n      console.error('Location tracking error:', error);\n      setTrackingError(error.message || 'Unknown location tracking error');\n      setIsTracking(false);\n    };\n    locationService.addListener('update', handleLocationUpdate);\n    locationService.addListener('error', handleLocationError);\n\n    // Start tracking\n    const success = locationService.startTracking();\n    setIsTracking(success);\n    return success;\n  };\n\n  // Stop location tracking\n  const stopLocationTracking = () => {\n    locationService.removeListener('update', () => {});\n    locationService.removeListener('error', () => {});\n    locationService.stopTracking();\n    setIsTracking(false);\n  };\n  return /*#__PURE__*/_jsxDEV(LocationContext.Provider, {\n    value: {\n      myLocation,\n      connectedUsers,\n      isTracking,\n      trackingError,\n      startLocationTracking,\n      stopLocationTracking\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 5\n  }, this);\n};\n_s2(LocationProvider, \"8xQkCeYrcttfWYF/lHBFXH5y7p8=\", false, function () {\n  return [useAuth];\n});\n_c = LocationProvider;\nvar _c;\n$RefreshReg$(_c, \"LocationProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useAuth","webSocketService","locationService","jsxDEV","_jsxDEV","LocationContext","useLocation","_s","LocationProvider","children","_s2","user","myLocation","setMyLocation","connectedUsers","setConnectedUsers","isTracking","setIsTracking","trackingError","setTrackingError","token","localStorage","getItem","connect","handleMessage","data","type","userId","id","prev","userName","role","coordinates","timestamp","addListener","removeListener","disconnect","startLocationTracking","handleLocationUpdate","handleLocationError","error","console","message","success","startTracking","stopLocationTracking","stopTracking","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Programming/Clubs/CIS/HackPrix/drift-guard-1pm/client/src/contexts/LocationContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport { useAuth } from './AuthContext';\nimport webSocketService from '../utils/websocket';\nimport locationService from '../utils/locationService';\n\nconst LocationContext = createContext();\n\nexport const useLocation = () => useContext(LocationContext);\n\nexport const LocationProvider = ({ children }) => {\n  const { user } = useAuth();\n  const [myLocation, setMyLocation] = useState(null);\n  const [connectedUsers, setConnectedUsers] = useState({});\n  const [isTracking, setIsTracking] = useState(false);\n  const [trackingError, setTrackingError] = useState(null);\n\n  // Initialize WebSocket connection when user is authenticated\n  useEffect(() => {\n    if (!user) return;\n\n    const token = localStorage.getItem('userToken');\n    if (!token) return;\n\n    // Connect to WebSocket\n    webSocketService.connect(token);\n\n    // Add WebSocket message listener\n    const handleMessage = (data) => {\n      if (data.type === 'locationUpdate' && data.userId !== user.id) {\n        setConnectedUsers(prev => ({\n          ...prev,\n          [data.userId]: {\n            userId: data.userId,\n            userName: data.userName,\n            role: data.role,\n            coordinates: data.coordinates,\n            timestamp: data.timestamp\n          }\n        }));\n      }\n    };\n\n    webSocketService.addListener('message', handleMessage);\n\n    // Cleanup\n    return () => {\n      webSocketService.removeListener('message', handleMessage);\n      webSocketService.disconnect();\n    };\n  }, [user]);\n\n  // Start location tracking\n  const startLocationTracking = () => {\n    if (!user) {\n      setTrackingError('User must be logged in to track location');\n      return false;\n    }\n\n    setTrackingError(null);\n\n    // Add location update listener\n    const handleLocationUpdate = (coordinates) => {\n      setMyLocation(coordinates);\n      setIsTracking(true);\n    };\n\n    const handleLocationError = (error) => {\n      console.error('Location tracking error:', error);\n      setTrackingError(error.message || 'Unknown location tracking error');\n      setIsTracking(false);\n    };\n\n    locationService.addListener('update', handleLocationUpdate);\n    locationService.addListener('error', handleLocationError);\n\n    // Start tracking\n    const success = locationService.startTracking();\n    setIsTracking(success);\n    return success;\n  };\n\n  // Stop location tracking\n  const stopLocationTracking = () => {\n    locationService.removeListener('update', () => {});\n    locationService.removeListener('error', () => {});\n    locationService.stopTracking();\n    setIsTracking(false);\n  };\n\n  return (\n    <LocationContext.Provider\n      value={{\n        myLocation,\n        connectedUsers,\n        isTracking,\n        trackingError,\n        startLocationTracking,\n        stopLocationTracking\n      }}\n    >\n      {children}\n    </LocationContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}